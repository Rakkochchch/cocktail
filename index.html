<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width,initial-scale=1,viewport-fit=cover"
        />
        <title>カクテル組み合わせ問題（スマホ最適）</title>
        <style>
            :root {
                --bg: #0b1020;
                --card: #121a33;
                --card2: #0f1730;
                --text: #e8ecff;
                --muted: #aab3da;
                --accent: #7aa2ff;
                --ok: #35d07f;
                --ng: #ff5c7a;
                --line: rgba(255, 255, 255, 0.1);
                --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
                --radius: 16px;
            }
            * {
                box-sizing: border-box;
                -webkit-tap-highlight-color: transparent;
            }
            body {
                margin: 0;
                font-family: system-ui, -apple-system, "Hiragino Sans",
                    "Noto Sans JP", sans-serif;
                background: var(--bg);
                color: var(--text);
            }
            header {
                position: sticky;
                top: 0;
                z-index: 10;
                padding: 14px 14px 10px;
                border-bottom: 1px solid var(--line);
                background: linear-gradient(
                    180deg,
                    rgba(11, 16, 32, 0.98),
                    rgba(11, 16, 32, 0.88)
                );
                backdrop-filter: blur(8px);
            }
            h1 {
                margin: 0 0 10px;
                font-size: 16px;
                letter-spacing: 0.02em;
            }
            .controls {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                align-items: center;
            }
            select {
                width: 100%;
                background: var(--card);
                color: var(--text);
                border: 1px solid var(--line);
                border-radius: 14px;
                padding: 12px 12px;
                font-size: 15px;
            }
            .controlRow {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                width: 100%;
            }
            @media (min-width: 720px) {
                .controlRow {
                    grid-template-columns: 1fr 1fr 1fr 1fr;
                }
            }
            main {
                max-width: 860px;
                margin: 0 auto;
                padding: 14px;
                padding-bottom: calc(92px + env(safe-area-inset-bottom));
            }
            .card {
                background: var(--card);
                border: 1px solid var(--line);
                border-radius: var(--radius);
                padding: 14px;
                box-shadow: var(--shadow);
            }
            .meta {
                color: var(--muted);
                font-size: 13px;
                line-height: 1.5;
            }
            .topbar {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 10px;
                margin-top: 10px;
                flex-wrap: wrap;
            }
            .pill {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 8px 10px;
                border-radius: 999px;
                background: rgba(255, 255, 255, 0.06);
                border: 1px solid var(--line);
                font-size: 13px;
                color: var(--muted);
            }
            .q {
                font-size: 18px;
                line-height: 1.35;
                margin: 12px 0 6px;
            }
            .hint {
                color: var(--muted);
                font-size: 13px;
                margin-bottom: 10px;
            }

            /* choices */
            .choices {
                display: grid;
                gap: 10px;
                margin-top: 10px;
            }
            .choice {
                display: flex;
                gap: 12px;
                align-items: center;
                padding: 14px 14px;
                border-radius: 16px;
                border: 1px solid var(--line);
                background: rgba(255, 255, 255, 0.03);
                cursor: pointer;
                user-select: none;
                min-height: 56px;
            }
            .choice:active {
                transform: scale(0.995);
            }
            .choice .label {
                flex: 1;
            }
            .choice .title {
                font-size: 16px;
                font-weight: 650;
            }
            .choice .sub {
                font-size: 12px;
                color: var(--muted);
                margin-top: 2px;
            }

            /* hide default inputs; keep accessible */
            .choice input {
                width: 1px;
                height: 1px;
                opacity: 0;
                position: absolute;
                pointer-events: none;
            }

            /* custom checkbox/radio */
            .mark {
                width: 26px;
                height: 26px;
                border-radius: 8px;
                border: 2px solid rgba(255, 255, 255, 0.22);
                display: grid;
                place-items: center;
                flex: 0 0 26px;
                background: rgba(0, 0, 0, 0.1);
            }
            .mark::after {
                content: "";
                width: 12px;
                height: 12px;
                border-radius: 4px;
                transform: scale(0);
                background: var(--accent);
                transition: transform 0.12s ease;
            }
            .choice[data-type="radio"] .mark {
                border-radius: 999px;
            }
            .choice[data-type="radio"] .mark::after {
                border-radius: 999px;
                width: 12px;
                height: 12px;
            }

            .choice.selected {
                border-color: rgba(122, 162, 255, 0.55);
                background: rgba(122, 162, 255, 0.1);
            }
            .choice.selected .mark {
                border-color: rgba(122, 162, 255, 0.8);
                background: rgba(122, 162, 255, 0.1);
            }
            .choice.selected .mark::after {
                transform: scale(1);
            }

            /* result toast */
            .result {
                margin-top: 12px;
                border-radius: 16px;
                padding: 12px 12px;
                border: 1px solid var(--line);
                display: none;
            }
            .result.ok {
                display: block;
                border-color: rgba(53, 208, 127, 0.5);
                background: rgba(53, 208, 127, 0.12);
            }
            .result.ng {
                display: block;
                border-color: rgba(255, 92, 122, 0.5);
                background: rgba(255, 92, 122, 0.12);
            }
            .result .big {
                font-size: 16px;
                font-weight: 700;
                margin-bottom: 4px;
            }
            .result .small {
                font-size: 13px;
                color: var(--muted);
            }

            /* bottom fixed actions */
            .actions {
                position: fixed;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 20;
                padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
                background: linear-gradient(
                    180deg,
                    rgba(11, 16, 32, 0),
                    rgba(11, 16, 32, 0.92) 20%,
                    rgba(11, 16, 32, 0.98)
                );
                border-top: 1px solid rgba(255, 255, 255, 0.06);
            }
            .actions .bar {
                max-width: 860px;
                margin: 0 auto;
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                gap: 10px;
            }
            button {
                width: 100%;
                padding: 14px 12px;
                border-radius: 16px;
                border: 1px solid var(--line);
                background: var(--card2);
                color: var(--text);
                font-size: 15px;
                font-weight: 650;
                cursor: pointer;
            }
            button.primary {
                background: rgba(122, 162, 255, 0.18);
                border-color: rgba(122, 162, 255, 0.4);
            }
            button:disabled {
                opacity: 0.55;
                cursor: not-allowed;
            }

            /* collapsible info */
            details {
                margin-top: 12px;
                border-radius: var(--radius);
                overflow: hidden;
                border: 1px solid var(--line);
                background: rgba(255, 255, 255, 0.03);
            }
            summary {
                padding: 12px 14px;
                cursor: pointer;
                font-weight: 650;
                list-style: none;
            }
            summary::-webkit-details-marker {
                display: none;
            }
            .detailsBody {
                padding: 0 14px 14px;
                color: var(--muted);
                font-size: 13px;
                line-height: 1.55;
            }
            .sep {
                height: 1px;
                background: rgba(255, 255, 255, 0.08);
                margin: 10px 0;
            }
        </style>
    </head>
    <body>
        <header>
            <h1>カクテル組み合わせ問題（スマホ最適・選択式）</h1>
            <div class="controls">
                <div class="controlRow">
                    <select id="mode" aria-label="モード">
                        <option value="nameToIng">
                            カクテル名 → 材料（複数選択）
                        </option>
                        <option value="ingToName">
                            材料 → カクテル名（4択）
                        </option>
                    </select>
                    <select id="difficulty" aria-label="難易度">
                        <option value="normal">通常</option>
                        <option value="easy">易しめ</option>
                    </select>
                </div>
            </div>
        </header>

        <main>
            <section class="card">
                <div class="meta">
                    PDF掲載のカクテル「材料 + 材料」表記を元にしたクイズです。
                </div>
                <div class="topbar">
                    <div class="pill">
                        スコア：<span id="score">0</span> /
                        <span id="total">0</span>
                    </div>
                    <div class="pill">問題ID：<span id="qid">-</span></div>
                </div>

                <div class="q" id="question">
                    下の「新しい問題」を押してください
                </div>
                <div class="hint" id="hint"></div>

                <div class="choices" id="choices"></div>

                <div id="result" class="result"></div>

                <details>
                    <summary>収録データを見る（折りたたみ）</summary>
                    <div class="detailsBody">
                        <div><b>収録カクテル</b></div>
                        <div id="list"></div>
                        <div class="sep"></div>
                        <div><b>材料一覧</b></div>
                        <div id="ings"></div>
                    </div>
                </details>
            </section>
        </main>

        <div class="actions">
            <div class="bar">
                <button class="primary" id="newQ">新しい問題</button>
                <button id="check">判定</button>
                <button id="reveal">答え</button>
            </div>
        </div>

        <script>
            /* PDFのカクテル記載（材料 + 材料）を元にしたデータ */
            const COCKTAILS = [
                {
                    name: "ジントニック",
                    ingredients: ["ジン", "トニックウォーター"],
                },
                {
                    name: "ジンバック",
                    ingredients: ["ジン", "ジンジャーエール"],
                },

                {
                    name: "カシスソーダ",
                    ingredients: ["カシスリキュール", "ソーダ"],
                },
                {
                    name: "カシスウーロン",
                    ingredients: ["カシスリキュール", "ウーロン茶"],
                },
                {
                    name: "カシスオレンジ",
                    ingredients: ["カシスリキュール", "オレンジジュース"],
                },
                {
                    name: "カシスグレープフルーツ",
                    ingredients: [
                        "カシスリキュール",
                        "グレープフルーツジュース",
                    ],
                },

                {
                    name: "モスコーミュール",
                    ingredients: ["ウォッカ", "ジンジャーエール"],
                },
                {
                    name: "ブラックルシアン",
                    ingredients: ["ウォッカ", "コーヒーリキュール"],
                },
                {
                    name: "スクリュードライバー",
                    ingredients: ["ウォッカ", "オレンジジュース"],
                },
                {
                    name: "ブラッディメアリー",
                    ingredients: ["ウォッカ", "トマトジュース"],
                },

                {
                    name: "ファジーネーブル",
                    ingredients: ["ピーチリキュール", "オレンジジュース"],
                },
                {
                    name: "ペシェウーロン",
                    ingredients: ["ピーチリキュール", "ウーロン茶"],
                },

                { name: "カンパリソーダ", ingredients: ["カンパリ", "ソーダ"] },
                {
                    name: "カンパリオレンジ",
                    ingredients: ["カンパリ", "オレンジジュース"],
                },
                {
                    name: "スプモーニ",
                    ingredients: [
                        "カンパリ",
                        "オレンジジュース",
                        "グレープフルーツ",
                        "トニックウォーター",
                    ],
                },

                {
                    name: "シャンディガフ",
                    ingredients: ["ビール", "ジンジャーエール"],
                },
                {
                    name: "レッドアイ",
                    ingredients: ["ビール", "トマトジュース"],
                },
                {
                    name: "カシスビア",
                    ingredients: ["ビール", "カシスリキュール"],
                },

                {
                    name: "キール",
                    ingredients: ["白ワイン", "カシスリキュール"],
                },
                { name: "スプリッツァー", ingredients: ["白ワイン", "ソーダ"] },
                {
                    name: "キールロワイヤル",
                    ingredients: ["スパークリングワイン", "カシスリキュール"],
                },
                {
                    name: "ミモザ",
                    ingredients: ["スパークリングワイン", "オレンジジュース"],
                },

                {
                    name: "カルーアミルク",
                    ingredients: ["コーヒーリキュール", "ミルク"],
                },
                {
                    name: "チャイナブルー",
                    ingredients: [
                        "ライチリキュール",
                        "グレープフルーツジュース",
                        "トニックウォーター",
                    ],
                },
                {
                    name: "照葉樹林",
                    ingredients: ["グリーンティーリキュール", "ウーロン茶"],
                },
            ];

            const modeEl = document.getElementById("mode");
            const diffEl = document.getElementById("difficulty");
            const questionEl = document.getElementById("question");
            const hintEl = document.getElementById("hint");
            const choicesEl = document.getElementById("choices");
            const resultEl = document.getElementById("result");
            const scoreEl = document.getElementById("score");
            const totalEl = document.getElementById("total");
            const qidEl = document.getElementById("qid");
            const listEl = document.getElementById("list");
            const ingsEl = document.getElementById("ings");

            const allIngredients = Array.from(
                new Set(COCKTAILS.flatMap((c) => c.ingredients))
            ).sort((a, b) => a.localeCompare(b, "ja"));
            listEl.textContent = COCKTAILS.map((c) => c.name).join("、");
            ingsEl.textContent = allIngredients.join("、");

            let state = {
                current: null,
                score: 0,
                total: 0,
                locked: false,
            };

            function shuffle(arr) {
                const a = arr.slice();
                for (let i = a.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [a[i], a[j]] = [a[j], a[i]];
                }
                return a;
            }

            function pickCocktail() {
                if (diffEl.value === "easy") {
                    const weighted = [];
                    for (const c of COCKTAILS) {
                        const w = Math.max(1, 5 - c.ingredients.length); // 材料が少ないほど出やすい
                        for (let i = 0; i < w; i++) weighted.push(c);
                    }
                    return weighted[
                        Math.floor(Math.random() * weighted.length)
                    ];
                }
                return COCKTAILS[Math.floor(Math.random() * COCKTAILS.length)];
            }

            function clearResult() {
                resultEl.className = "result";
                resultEl.style.display = "none";
                resultEl.innerHTML = "";
            }

            function setResult(ok, title, detail) {
                resultEl.style.display = "block";
                resultEl.className = "result " + (ok ? "ok" : "ng");
                resultEl.innerHTML = `<div class="big">${title}</div><div class="small">${detail}</div>`;
            }

            function lockInputs() {
                state.locked = true;
                choicesEl
                    .querySelectorAll(".choice")
                    .forEach((c) => (c.style.pointerEvents = "none"));
            }

            function buildChoiceCard({ type, text, name, value }) {
                // type: checkbox|radio（見た目用）
                const card = document.createElement("div");
                card.className = "choice";
                card.dataset.type = type;
                card.dataset.value = value;
                card.setAttribute(
                    "role",
                    type === "radio" ? "radio" : "checkbox"
                );
                card.setAttribute("aria-checked", "false");

                // hidden input keeps semantics for reading selection
                const input = document.createElement("input");
                input.type = type;
                input.name = name;
                input.value = value;

                const mark = document.createElement("div");
                mark.className = "mark";

                const label = document.createElement("div");
                label.className = "label";
                label.innerHTML = `<div class="title">${text}</div><div class="sub">${
                    type === "radio" ? "カクテル名" : "材料"
                }</div>`;

                card.appendChild(input);
                card.appendChild(mark);
                card.appendChild(label);

                card.addEventListener("click", () => {
                    if (state.locked) return;

                    if (type === "radio") {
                        // 既存の選択解除
                        choicesEl.querySelectorAll(".choice").forEach((el) => {
                            el.classList.remove("selected");
                            el.setAttribute("aria-checked", "false");
                            const inp = el.querySelector("input");
                            inp.checked = false;
                        });
                        card.classList.add("selected");
                        card.setAttribute("aria-checked", "true");
                        input.checked = true;
                    } else {
                        // checkbox toggle
                        const next = !input.checked;
                        input.checked = next;
                        card.classList.toggle("selected", next);
                        card.setAttribute(
                            "aria-checked",
                            next ? "true" : "false"
                        );
                    }
                });

                return card;
            }

            function renderQuestion() {
                state.locked = false;
                clearResult();

                const cocktail = pickCocktail();
                const qid = Math.random().toString(16).slice(2, 8);
                qidEl.textContent = qid;

                const mode = modeEl.value;

                if (mode === "nameToIng") {
                    const correct = new Set(cocktail.ingredients);
                    const wrongPool = allIngredients.filter(
                        (x) => !correct.has(x)
                    );
                    const wrongCount = Math.min(6, wrongPool.length);
                    const options = shuffle([
                        ...cocktail.ingredients,
                        ...shuffle(wrongPool).slice(0, wrongCount),
                    ]);

                    state.current = {
                        type: "nameToIng",
                        cocktail,
                        correctSet: correct,
                        options,
                    };

                    questionEl.textContent = `「${cocktail.name}」の材料を選びなさい`;
                    hintEl.textContent =
                        "複数選択OK。正しい材料を全部選んで「判定」。";

                    choicesEl.innerHTML = "";
                    options.forEach((opt) => {
                        choicesEl.appendChild(
                            buildChoiceCard({
                                type: "checkbox",
                                text: opt,
                                name: "ing",
                                value: opt,
                            })
                        );
                    });
                } else {
                    const ingText = shuffle(cocktail.ingredients).join(" + ");
                    const correctName = cocktail.name;
                    const wrongNames = shuffle(
                        COCKTAILS.filter((c) => c.name !== correctName).map(
                            (c) => c.name
                        )
                    ).slice(0, 3);
                    const options = shuffle([correctName, ...wrongNames]);

                    state.current = {
                        type: "ingToName",
                        cocktail,
                        ingText,
                        correctName,
                        options,
                    };

                    questionEl.textContent = `材料「${ingText}」のカクテル名を選びなさい`;
                    hintEl.textContent = "1つ選択して「判定」。";

                    choicesEl.innerHTML = "";
                    options.forEach((opt) => {
                        choicesEl.appendChild(
                            buildChoiceCard({
                                type: "radio",
                                text: opt,
                                name: "name",
                                value: opt,
                            })
                        );
                    });
                }
            }

            function getSelected() {
                if (!state.current) return [];
                if (state.current.type === "nameToIng") {
                    return Array.from(
                        document.querySelectorAll('input[name="ing"]:checked')
                    ).map((x) => x.value);
                }
                const r = document.querySelector('input[name="name"]:checked');
                return r ? [r.value] : [];
            }

            function checkAnswer() {
                if (!state.current || state.locked) return;

                const selected = getSelected();
                if (selected.length === 0) {
                    setResult(
                        false,
                        "未選択です",
                        "どれか選んでから判定してください。"
                    );
                    return;
                }

                state.total += 1;
                totalEl.textContent = state.total;

                if (state.current.type === "nameToIng") {
                    const correct = state.current.correctSet;
                    const selSet = new Set(selected);
                    let ok = true;

                    for (const c of correct) {
                        if (!selSet.has(c)) ok = false;
                    }
                    for (const s of selSet) {
                        if (!correct.has(s)) ok = false;
                    }

                    if (ok) {
                        state.score += 1;
                        scoreEl.textContent = state.score;
                        setResult(
                            true,
                            "正解！",
                            "選んだ材料がすべて一致しました。"
                        );
                    } else {
                        setResult(
                            false,
                            "不正解",
                            `正解：${state.current.cocktail.ingredients.join(
                                " + "
                            )}`
                        );
                    }
                    lockInputs();
                } else {
                    const ans = state.current.correctName;
                    const ok = selected[0] === ans;
                    if (ok) {
                        state.score += 1;
                        scoreEl.textContent = state.score;
                        setResult(
                            true,
                            "正解！",
                            "その組み合わせのカクテル名で合っています。"
                        );
                    } else {
                        setResult(false, "不正解", `正解：${ans}`);
                    }
                    lockInputs();
                }
            }

            function revealAnswer() {
                if (!state.current) return;
                if (state.current.type === "nameToIng") {
                    setResult(
                        true,
                        "答え",
                        `${
                            state.current.cocktail.name
                        } = ${state.current.cocktail.ingredients.join(" + ")}`
                    );
                } else {
                    setResult(
                        true,
                        "答え",
                        `${state.current.ingText} = ${state.current.correctName}`
                    );
                }
            }

            document
                .getElementById("newQ")
                .addEventListener("click", renderQuestion);
            document
                .getElementById("check")
                .addEventListener("click", checkAnswer);
            document
                .getElementById("reveal")
                .addEventListener("click", revealAnswer);

            // モード/難易度変更で即出題し直し
            modeEl.addEventListener("change", renderQuestion);
            diffEl.addEventListener("change", renderQuestion);

            // 初回は自動で1問出す（スマホで手数を減らす）
            renderQuestion();
        </script>
    </body>
</html>
